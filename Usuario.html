<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Eventos Corporativos</title>
<link rel="stylesheet" href="fundodetelas.css">
<link rel="stylesheet" href="Usuario.css">
<link rel="stylesheet" href="transicoes.css">
</head>

<body>
<div class="principio">
    <div class="esquerda">
        <h1 class="txt">PRÓXIMOS EVENTOS:</h1>
        <hr style="background-color: white;">

    </div>

    <div class="direita">
        <a href="TelaLogin.html"><img src="img/participe_dois.png" alt="imagem" class="logo"></a>
        <p class="motivacao">CONECT-SE, PARTICIPE, VIVA EXPERIÊNCIAS!</p>
        <p class="motivacao">FAÇA O SEU<br>CHECKIN NOS<br>PRÓXIMOS<br>EVENTOS!</p>
    </div>
</div>
<script src="transicoes.js"></script>
<script src="Checkin.js"></script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
    const eventosContainer = document.querySelector(".esquerda");

    function formatarData(dataISO) {
        const data = new Date(dataISO);
        const dia = String(data.getDate()).padStart(2, "0");
        const mes = String(data.getMonth() + 1).padStart(2, "0");
        const ano = data.getFullYear();
        const hora = String(data.getHours()).padStart(2, "0");
        const minuto = String(data.getMinutes()).padStart(2, "0");
        return `${dia}/${mes}/${ano} — ${hora}:${minuto}`;
    }

    async function fazerCheckin(eventoId, botao) {
        try {
            const response = await fetch(`http://localhost:8000/event/${eventoId}/checkin`, {
                method: "POST",
                credentials: "include"
            });

            if (response.ok) {
                botao.style.backgroundColor = "#4CAF50"; // verde
                botao.textContent = "CHECK-IN FEITO";
                botao.disabled = true; // opcional, para não permitir múltiplos check-ins
            } else {
                throw new Error("Falha no check-in");
            }
        } catch (err) {
            console.error("Erro no check-in:", err);
            alert("Erro ao fazer check-in");
        }
    }

    try {
        const response = await fetch("http://localhost:8000/event", {
            method: "GET",
            credentials: "include"
        });

        if (!response.ok) throw new Error("Falha ao carregar eventos");

        const eventos = await response.json();

        const staticEventos = eventosContainer.querySelectorAll(".evento");
        staticEventos.forEach(ev => ev.remove());

        eventos.forEach(evento => {
            const eventDiv = document.createElement("div");
            eventDiv.classList.add("evento");

            const eventHTML = `
                <div class="evento-info">
                    <h3>${evento.name}</h3>
                    <p>${evento.description}</p>
                    <div class="botao-info">
                        <span class="hora">${formatarData(evento.date)}</span>
                        <button class="checkin">CHECK-IN</button>
                    </div>
                </div>
            `;

            eventDiv.innerHTML = eventHTML;
            eventosContainer.appendChild(eventDiv);

            const botaoCheckin = eventDiv.querySelector(".checkin");
            botaoCheckin.addEventListener("click", () => {
                fazerCheckin(evento.id, botaoCheckin);
            });
        });

    } catch (err) {
        console.error("Erro ao buscar eventos:", err);
        eventosContainer.insertAdjacentHTML("beforeend", `<p style="color:red;">Não foi possível carregar os eventos.</p>`);
    }
});
</script>


</body>
</html>
