<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Eventos</title>
    <link rel="stylesheet" href="fundodetelas.css">
    <link rel="stylesheet" href="ListaEventos.css">
    <link rel="stylesheet" href="transicoes.css">
</head>
<body>
<div class="container">
    <div class="logo">
        <a href="TelaLogin.html"><img src="img/logo_dois.png" alt="Participe"></a>
    </div>

    <div class="card-lista">
        <h1 class="titulo-lista">Lista de Eventos</h1>
        
        <div class="tabela-container">
            <table>
                <thead>
                    <tr>
                            <th>Nome</th>
                            <th>Email</th>
                    </tr>
                </thead>
                <tbody id="corpo-tabela">
                    <tr>
                        <td colspan="5" class="sem-dados">Nenhum evento cadastrado ainda.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <a href="Administrador.html"><button type="button" class="btn-voltar">VOLTAR</button></a>
    </div>
</div>

<script src="transicoes.js"></script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const urlParams = new URLSearchParams(window.location.search);
    const eventoId = urlParams.get("id");

    const tbody = document.getElementById("corpo-tabela");
    if (!eventoId) {
        tbody.innerHTML = `<tr><td colspan="2" class="sem-dados">ID do evento não fornecido.</td></tr>`;
        return;
    }

    try {
        const response = await fetch(`http://localhost:8000/event/${eventoId}/checkin`, {
            method: "GET",
            credentials: "include"
        });

        if (!response.ok) throw new Error("Falha ao carregar usuários");

        const usuarios = (await response.json()) || [];

        if (!Array.isArray(usuarios) || usuarios.length === 0) {
            tbody.innerHTML = `<tr><td colspan="2" class="sem-dados">Nenhum usuário confirmado ainda.</td></tr>`;
            return;
        }

        tbody.innerHTML = "";

        usuarios.forEach(u => {
            const tr = document.createElement("tr");

            const tdNome = document.createElement("td");
            tdNome.textContent = u.name;
            tr.appendChild(tdNome);

            const tdEmail = document.createElement("td");
            tdEmail.textContent = u.email;
            tr.appendChild(tdEmail);

            tbody.appendChild(tr);
        });

    } catch (err) {
        console.error("Erro ao buscar usuários:", err);
        tbody.innerHTML = `<tr><td colspan="2" class="sem-dados">Erro ao carregar usuários.</td></tr>`;
    }
});
</script>


</body>
</html>
